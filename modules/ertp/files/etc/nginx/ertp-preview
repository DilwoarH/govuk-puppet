server {
  server_name  preview-ertp.alphagov.co.uk;
  listen *:80;

  location /stats {
    proxy_pass http://127.0.0.1:9500;
    deny all;
    auth_basic            "Enter your ertp admin password";
    auth_basic_user_file  /etc/nginx/htpasswd/htpasswd.ertp.preview;
    satisfy any;
  }

  location /prototype {
    proxy_pass http://127.0.0.1:9000/prototype;
    deny all;
    auth_basic            "Enter your ertp password";
    auth_basic_user_file  /etc/nginx/htpasswd/htpasswd.ertp.preview;
    satisfy any;
  }

  location / {
    rewrite ^/(.*)$ /register-to-vote redirect;
  }

  location /register-to-vote {
    proxy_pass http://127.0.0.1:9000/register-to-vote;
    deny all;
    auth_basic            "Enter your ertp password";
    auth_basic_user_file  /etc/nginx/htpasswd/htpasswd.ertp.preview;
    satisfy any;
  }
}
