---
- scm:
    name: govuk-cdn-logs-monitor
    scm:
        - git:
            url: git@github.com:alphagov/govuk-cdn-logs-monitor.git
            branches:
              - release

- job:
    name: govuk_cdn_nightly_2xx_status_collection
    display-name: GOVUK_CDN_Nightly
    disabled: false
    project-type: freestyle
    description: |
      Every morning the CDN log for GOV.UK rotates, this job collects all GOV.UK URLs that returned a 2XX status for yesterday's site activity.
    scm:
      - govuk-cdn-logs-monitor
    builders:
      - shell: |
          ssh deploy@logs-cdn-1.management '
            cd /var/apps/govuk-cdn-logs-monitor &&
            govuk_setenv govuk-cdn-logs-monitor sh nightly_run.sh &&
            govuk_setenv govuk-cdn-logs-monitor sh accumulate.sh
          '
    logrotate:
      artifactNumToKeep: 14
    triggers:
      - timed: 'H 7 * * *'
