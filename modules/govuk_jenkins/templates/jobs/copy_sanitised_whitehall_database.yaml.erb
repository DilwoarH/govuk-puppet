---
- scm:
    name: env-sync-and-backup_copy_sanitised_whitehall_database
    scm:
        - git:
            url: git@github.com:alphagov/env-sync-and-backup.git
            branches:
              - master

- job:
    name: copy_sanitised_whitehall_database
    display-name: Copy and Sync sanitised whitehall database
    project-type: freestyle
    description: |
        This job sanitises the whitehall database and then loads it
        into integration to keep them up to date.
    properties:
        - github:
            url: https://github.com/alphagov/env-sync-and-backup/
    scm:
      - env-sync-and-backup_copy_sanitised_whitehall_database
    logrotate:
        numToKeep: 10
    triggers:
        - timed: '15 5 * * 1-5'
    discard_old: # Discard old builds after:
      days: 30 # Optional, number of days after which the build is deleted
      artifact_number: 4 # Optional, number of builds after which the artifact is deleted
    builders:
        - shell: |
            cd "$WORKSPACE/whitehall/"
            echo "Sanitising whitehall database"
            ./sanitise-and-sync-db.sh "<%= @whitehall_mysql_password %>"
    wrappers:
        - ansicolor:
            colormap: xterm
        - timestamps
