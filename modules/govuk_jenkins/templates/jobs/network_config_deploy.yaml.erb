---
- scm:
    name: govuk-provisioning_Network_Config_Deploy
    scm:
        - git:
            url: git@github.gds:gds/govuk-provisioning.git
            branches:
              - master
            wipe-workspace: false
            clean:
                after: true

- job:
    name: Network_Config_Deploy
    display-name: Network_Config_Deploy
    project-type: freestyle
    description: "This job configures the edge gateway in *<%= @environment -%>*. It uses the configuration in the govuk-provisioning repo."
    properties:
        - github:
            url: https://github.gds/gds/govuk-provisioning/
    scm:
      - govuk-provisioning_Network_Config_Deploy
    builders:
        - shell: |
            ./vcloud-edge_gateway/jenkins.sh ${TARGET_ENVIRONMENT}
    publishers:
        - trigger:
            project: Smokey
    wrappers:
        - ansicolor:
            colormap: xterm
        - build-name:
            name: '#${BUILD_NUMBER} ${ENV,var="component"}'
    parameters:
        - choice:
            name: COMPONENT
            description: Which part of the networking config do you wish to update?
            choices:
                - PLEASE CHOOSE ONE
                - lb
                - nat
                - firewall
                - vpn
        - string:
            name: USERNAME
            description: Vcloud username
        - password:
            name: VCLOUD_PASSWORD
            description: Vcloud Password
        - choice:
            name: TARGET_ENVIRONMENT
            description: The environment to deploy network configuration to
            choices:
                <%- @environments.each do |env| -%>
                - <%= env %>
                <%- end -%>
