# This file is managed by Puppet. Local changes will be clobbered.

<%- if @enable_ssl -%>
server {
  server_name ganglia ganglia.*;
  listen 80;
  rewrite ^/(.*) https://$host/$1 permanent;
}
<%- end -%>

server {
  server_name ganglia ganglia.*;

  <%- if !@enable_ssl -%>
  listen 80;
  <%- else -%>
  listen              443 ssl;
  ssl_certificate     /etc/nginx/ssl/ganglia.crt;
  ssl_certificate_key /etc/nginx/ssl/ganglia.key;
  include             /etc/nginx/ssl.conf;
  <%- end -%>

  index index.php index.html;
  root /var/www/ganglia-web-3.5.0;

  access_log /var/log/nginx/ganglia-access.log timed_combined;
  error_log /var/log/nginx/ganglia-error.log;

  <%- if @monitoring_protected -%>
  auth_basic "Ganglia Restricted Access";
  auth_basic_user_file /etc/govuk.htpasswd;
  <%- end -%>

  location ~ \.php$ {
    include /etc/nginx/fastcgi_params;
    fastcgi_pass php;
  }

  location /views {
    alias /var/www/ganglia-views;
  }
}
