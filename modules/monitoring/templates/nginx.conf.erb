<%- if @enable_ssl -%>
server {
  server_name monitoring monitoring.*;
  listen 80;
  rewrite ^/(.*) https://$host/$1 permanent;
}
<%- end -%>

server {
  server_name monitoring monitoring.*;

  <%- if !@enable_ssl -%>
  listen 80;
  <%- else -%>
  listen              443 ssl default_server;
  ssl_certificate     /etc/nginx/ssl/monitoring.crt;
  ssl_certificate_key /etc/nginx/ssl/monitoring.key;
  include             /etc/nginx/ssl.conf;
  <%- end -%>

  index index.html;
  root /var/www/monitoring;

  access_log /var/log/nginx/monitoring-access.log timed_combined;
  access_log /var/log/nginx/monitoring-json.event.access.log json_event;
  error_log /var/log/nginx/monitoring-error.log;

  auth_basic "Enter your username/password";
  auth_basic_user_file /etc/govuk.htpasswd;
}
