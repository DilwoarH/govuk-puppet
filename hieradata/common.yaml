---
HIERA_SAFETY_CHECK: true

app_domain: 'dev.gov.uk'

apt::always_apt_update: true
apt::purge_preferences_d: true
apt::purge_sources_list_d: true
# FIXME: Use regex/glob when we no longer support Lucid.
apt::unattended_upgrades::blacklist:
 - 'mysql-server'
 - 'mysql-server-4.1'
 - 'mysql-server-5.0'
 - 'mysql-server-5.1'
 - 'mysql-server-5.5'
 - 'mysql-server-core'
 - 'mysql-server-core-5.0'
 - 'mysql-server-core-5.1'
 - 'mysql-server-core-5.5'
apt::unattended_upgrades::mail_to: 'machine.email@digital.cabinet-office.gov.uk'
apt::unattended_upgrades::origins:
 - "%{::lsbdistid} stable"
 - "%{::lsbdistid} %{::lsbdistcodename}-security"

_: &offsite_gpg_key '13B84C37AB52D76B3F53CF0E7C34BD7A05119BA4'
_: &offsite_host 'backup0.backup.provider1.production.govuk.service.gov.uk'
_: &offsite_ssh_key 'AAAAB3NzaC1yc2EAAAADAQABAAABAQDR88DkaA+y/fQUYcIN15t/1IpiFf4rCZdoIlXfCiVLE2TaDQY7viH/1y0DV2fQiSUg+17Hz/RK6wKw09V0nPw/edGUYR7kUZ6m1bbNkny/d5YgZLEyrW1to99f2LvsLYRsQJWXSlpi2uYMaScmbDbVZrUoIAovJv2jpBjhXKIVd/NhQ19LTTS2rqSukL+TImQ1+nO26UMLeRoLLDzdboPebR5pVQE0khAZZOnEfD7V5jObqu8VlO7U/xHaC5M4tz9CNmk1nhMgZtHQd5hLANCx1hROWdmJeH7egzPD7d9fBwL2gi2SQXf1LgEub+ZEIVYWSJ+14PqVzuxCTS0aOGmp'

backup::assets::dest_host: *offsite_host
backup::assets::dest_host_key: *offsite_ssh_key
backup::assets::jobs:
  'assets-whitehall':
    sources: '/mnt/uploads/whitehall'
    destination: "rsync://govuk-assets@%{hiera('backup::assets::dest_host')}//srv/backup-assets/whitehall"
    hour: 4
    minute: 20
    user: 'root'
    gpg_key_id: *offsite_gpg_key
  'asset-manager':
    sources: '/mnt/uploads/asset-manager'
    destination: "rsync://govuk-assets@%{hiera('backup::assets::dest_host')}//srv/backup-assets/asset-manager"
    hour: 4
    minute: 13
    user: 'root'
    gpg_key_id: *offsite_gpg_key

backup::offsite::dest_host: *offsite_host
backup::offsite::dest_host_key: *offsite_ssh_key
backup::offsite::jobs:
  'govuk-datastores':
    sources:
      - '/data/backups/*/var/lib/automongodbbackup/latest'
      - '/data/backups/*/var/lib/automysqlbackup/latest.tbz2'
      - '/data/backups/*/var/lib/autopostgresqlbackup/latest.tbz2'
      - '/data/backups/archived'
    destination: "rsync://%{hiera('backup::offsite::dest_host')}//srv/backup-data/"
    hour: 8,
    minute: 13,
    gpg_key_id: *offsite_gpg_key
  'govuk-graphite':
    sources: '/data/backups/*/opt/graphite/storage/whisper'
    destination: "rsync://%{hiera('backup::offsite::dest_host')}//srv/backup-graphite/"
    hour: 8,
    minute: 13,
    # No encryption because of size and sensitivity

govuk_cdnlogs::rotate_logs_hourly: ['bouncer']
govuk_cdnlogs::service_port_map:
  govuk: 6514
  assets: 6515
  bouncer: 6516

govuk_crawler::amqp_host: 'rabbitmq-1.backend'
govuk_crawler::govuk_gemfury_source_url: "%{hiera('govuk_gemfury_source_url')}"
govuk_crawler::site_root: 'https://www.gov.uk'

govuk_gemfury_source_url: 'https://BnrJb6FZyzspBboNJzYZ@gem.fury.io/govuk/'

govuk_jenkins::github_enterprise_cert: |
    -----BEGIN CERTIFICATE-----
    MIIEdDCCA1ygAwIBAgIJAKt4YiHj0+tVMA0GCSqGSIb3DQEBBQUAMIGCMQswCQYD
    VQQGEwJHQjEPMA0GA1UECBMGTG9uZG9uMQ8wDQYDVQQHEwZMb25kb24xFzAVBgNV
    BAoTDkNhYmluZXQgT2ZmaWNlMSMwIQYDVQQLExpHb3Zlcm5tZW50IERpZ2l0YWwg
    U2VydmljZTETMBEGA1UEAxMKZ2l0aHViLmdkczAeFw0xMzAxMDcxNTE5MjhaFw0x
    ODAxMDYxNTE5MjhaMIGCMQswCQYDVQQGEwJHQjEPMA0GA1UECBMGTG9uZG9uMQ8w
    DQYDVQQHEwZMb25kb24xFzAVBgNVBAoTDkNhYmluZXQgT2ZmaWNlMSMwIQYDVQQL
    ExpHb3Zlcm5tZW50IERpZ2l0YWwgU2VydmljZTETMBEGA1UEAxMKZ2l0aHViLmdk
    czCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANiLTHwolRWmRZeIeboY
    4L4VUoMv6zg0rovpzX1hdzdJ5Gn6OoxaADO78Al85/9jRXIYyun6d9iRAknb1ZrG
    yxLQ8mmMl8rqbHa/mBK42G5NVL703712NslcNfeY/FvvdtVBjUI1EIRbehDYMYET
    aqX88HAvohyIoe1LJ4+6t2hF+P1dP7DQvxcu4eBlaywssbvt+FVnYIY87X6CdrVe
    bkMWh0C7J32uY4lEyamcl/M//KjJWFDBkFTbdguZW+KeFwfecVh+OpsdNRKzI3vX
    zriHE7icrJWw5jssE2ZMregLfc1bZ5zpPljEFVxDzyIuseUuVxYQSr1GNwrzr1ix
    LIECAwEAAaOB6jCB5zAdBgNVHQ4EFgQUxjT7A9kz7MecUpg6QCMWteDYF7wwgbcG
    A1UdIwSBrzCBrIAUxjT7A9kz7MecUpg6QCMWteDYF7yhgYikgYUwgYIxCzAJBgNV
    BAYTAkdCMQ8wDQYDVQQIEwZMb25kb24xDzANBgNVBAcTBkxvbmRvbjEXMBUGA1UE
    ChMOQ2FiaW5ldCBPZmZpY2UxIzAhBgNVBAsTGkdvdmVybm1lbnQgRGlnaXRhbCBT
    ZXJ2aWNlMRMwEQYDVQQDEwpnaXRodWIuZ2RzggkAq3hiIePT61UwDAYDVR0TBAUw
    AwEB/zANBgkqhkiG9w0BAQUFAAOCAQEASTEwAV+wKUbQcBOKAWsZpPAxw168uRU/
    KVp7XRE7XyOZUPL2OJ9RLRZz1hCgOuwx304DVLfQVeDp+uhsQzmkdxbBto23ejyh
    8gXdHEnbjf2FN1dVomcDo7jqAqBU7Ji/c7sCLU/2z3ILt0fzwrEj3WQOl7dqYxY1
    qruyrjFTQOclWUJKzHqlIKr3iBFVE0Z1EVywWKeV1CwKkikYhTjZGs0goCy0LHrj
    LG8Mr4r1mOsqtUPYYjCN77EOwkRUucvIt1zNPoiD21OXzzxdOIUOUq6l/kERSfba
    LWIWJn/KXkog8bU776IixxWlO8l1TwiCUoDS9YsLIKIRCT74QE48qA==
    -----END CERTIFICATE-----

govuk_mysql::server::expire_log_days: 3

govuk_postgresql::server::configure_env_sync_user: true

govuk_sudo::sudo_conf:
  deploy_init_ctl:
    content: 'deploy ALL=NOPASSWD:/sbin/initctl'
  deploy_service_nginx:
    content: 'deploy ALL=NOPASSWD:/etc/init.d/nginx'
  deploy_service_varnish:
    content: 'deploy ALL=NOPASSWD:/etc/init.d/varnish'
  ubuntu:
    content: 'ubuntu ALL=(ALL) NOPASSWD:ALL'

govuk_unattended_reboot::etcd_endpoints:
  - "http://etcd-1.management:4001"
  - "http://etcd-2.management:4001"
  - "http://etcd-3.management:4001"

heka::package_ensure: '0.8.3'
heka::plugin::graphite::host: 'graphite.cluster'
# FIXME: Remove when CarbonOutput supports `use_buffering`.
heka::plugin::graphite::protocol: 'udp'
heka::plugin::tcp_output::host: 'logging.cluster'
heka::plugin::tcp_output::port: 5565

mongodb::server::version: '2.4.9'

nginx::package::version: '1.4.6-1ubuntu3.1'

nodejs::version: '0.10.25~dfsg2-2ubuntu1'

ntp::server_list:
  - 'ntp.ubuntu.com'
  - 'time.euro.apple.com'
  - '0.uk.pool.ntp.org'
  - '1.uk.pool.ntp.org'
  - '2.uk.pool.ntp.org'

postgresql::globals::version: '9.3'

rabbitmq::delete_guest_user: true
rabbitmq::config_stomp: true
# Always use our mirror because they only provide the latest package.
rabbitmq::package_ensure: '3.4.3-1'
rabbitmq::manage_repos: false

# TODO: These don't work in 2.6.6 so setting to false
# consider changing if we update redis version
redis::conf_aof_rewrite_incremental_fsync: false
redis::conf_hz: false
redis::conf_repl_disable_tcp_nodelay: false
redis::conf_tcp_keepalive: false
# end TODO
# TODO: Replace this with `conf_tcp_keepalive`.
redis::conf_timeout: 300

resolvconf::nameservers:
  - 8.8.8.8
  - 8.8.4.4

router::assets_origin::asset_routes:
  '/businesssupportfinder/': "businesssupportfinder"
  '/calculators/': "calculators"
  '/calendars/': "calendars"
  '/collections/': "collections"
  '/contacts-assets/': "contacts-frontend-old"
  '/contacts-frontend/': "contacts-frontend"
  '/designprinciples/': "designprinciples"
  '/feedback/': "feedback"
  '/finder-frontend/': "finder-frontend"
  '/frontend/': "frontend"
  '/government/assets/': "whitehall-frontend"
  '/government/placeholder': "whitehall-frontend"
  '/government/uploads/': "whitehall-frontend"
  '/government-frontend/': "government-frontend"
  '/info-frontend/': "info-frontend"
  '/manuals-frontend/': "manuals-frontend"
  '/licencefinder/': "licencefinder"
  '/smartanswers/': "smartanswers"
  '/specialist-frontend/': "specialist-frontend"
  '/tariff/': "tariff"
  '/transactions-explorer/': "transactions-explorer"

unicornherder::version: '0.0.8'
