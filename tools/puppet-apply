#!/bin/sh
set -e

# Filter warnings about 'storeconfigs' not being set
exec sudo \
  RBENV_VERSION=1.9.3 \
  puppet apply /var/govuk/puppet/manifests \
  --trusted_node_data \
  --environment ${ENVIRONMENT:-development} \
  --modulepath /var/govuk/puppet/modules:/var/govuk/puppet/vendor/modules \
  --manifestdir /var/govuk/puppet/manifests \
  --hiera_config /var/govuk/puppet/hiera.yml "$@" 2>&1 \
  | egrep -iv --line-buffered "warning:.+storeconfigs"
